<!DOCTYPE html>
<html>

<head>
    <title>Product Page</title>

    <style>
        body {
            font-family: Poppins, sans-serif;
            background: #f8f5f0;
            margin: 0;
        }

        h1 {
            text-align: center;
            margin: 40px 0 20px;
            color: #3b2a20;
        }

        /* ===== FILTER BAR ===== */
        .filter-bar {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 0 60px 30px;
        }

        .filter-bar input,
        .filter-bar select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            max-width: 300px;
            font-family: Poppins, sans-serif;
        }

        /* ===== PRODUCTS GRID ===== */
        .products {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            padding: 0 60px 60px;
        }

        .product-card {
            background: #fff;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        .product-card img {
            width: 100%;
            height: 260px;
            object-fit: cover;
            border-radius: 4px;
        }

        .product-card h3 {
            margin: 15px 0 5px;
            color: #3b2a20;
        }

        .price {
            color: #b08d57;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .btn-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            text-decoration: none;
        }

        .view {
            background: #3b2a20;
            color: #fff;
        }

        .cart {
            background: #d4af37;
            color: #fff;
        }

        .btn:hover {
            opacity: 0.9;
        }

        @media(max-width:900px) {
            .products {
                grid-template-columns: repeat(2, 1fr);
                padding: 0 20px 40px;
            }

            .filter-bar {
                padding: 0 20px 20px;
                flex-direction: column;
            }
        }

        @media(max-width:500px) {
            .products {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <%- include('../common/header') %>

        <h1>Our Jewellery Products </h1>


        <div class="filter-bar">
            <input type="text" id="searchInput" placeholder="Search jewellery...">

            <select id="sortSelect">
                <option value="">Sort By</option>
                <option value="name-asc">Name : A â†’ Z</option>
                <option value="name-desc">Name : Z â†’ A</option>
                <option value="price-asc">Price : Low â†’ High</option>
                <option value="price-desc">Price : High â†’ Low</option>
            </select>
        </div>


        <div class="products">
            <% products.forEach(p=> { %>
                <div class="product-card" data-name="<%= p.ProductName.toLowerCase() %>"
                    data-price="<%= p.Productprice %>">

                    <img src="<%= p.ProductImage %>" alt="<%= p.ProductName %>">

                    <h3>
                        <%= p.ProductName %>
                    </h3>

                    <p class="price">â‚¹ <%= p.Productprice %>
                    </p>

                    <div class="btn-group">
                        <a href="/websitepage/single-product/<%= p._id %>" class="btn view">
                            View
                        </a>

                        <button class="btn cart" onclick="addToCart(this)" data-id="<%= p._id %>">
                            Add to Cart
                        </button>


                    </div>
                </div>
                <% }) %>
        </div>


        <script>
            const searchInput = document.getElementById("searchInput");
            const sortSelect = document.getElementById("sortSelect");
            const productCards = Array.from(document.querySelectorAll(".product-card"));
            const productContainer = document.querySelector(".products");


            searchInput.addEventListener("input", () => {
                const value = searchInput.value.toLowerCase();
                productCards.forEach(card => {
                    const name = card.dataset.name;
                    card.style.display = name.includes(value) ? "block" : "none";
                });
            });


            sortSelect.addEventListener("change", () => {
                let sorted = [...productCards];

                if (sortSelect.value === "name-asc") {
                    sorted.sort((a, b) => a.dataset.name.localeCompare(b.dataset.name));
                }

                if (sortSelect.value === "name-desc") {
                    sorted.sort((a, b) => b.dataset.name.localeCompare(a.dataset.name));
                }

                if (sortSelect.value === "price-asc") {
                    sorted.sort((a, b) => a.dataset.price - b.dataset.price);
                }

                if (sortSelect.value === "price-desc") {
                    sorted.sort((a, b) => b.dataset.price - a.dataset.price);
                }

                sorted.forEach(card => productContainer.appendChild(card));
            });
           
function addToCart(btn) {
  const productId = btn.getAttribute("data-id");

  fetch("/cart/add-to-cart", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ productId })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("Added to cart ðŸ›’");
      
      
      if (typeof loadCartCount === "function") {
        loadCartCount();
      }
    }
  })
  .catch(err => console.log(err));
}

        </script>

</body>

</html>